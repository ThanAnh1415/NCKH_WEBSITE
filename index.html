<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh·∫£ NƒÉng Ph·ª•c H·ªìi & √Åp L·ª±c H·ªçc T·∫≠p</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- C√ÄI ƒê·∫∂T CSS TO√ÄN C·ª§C --- */
        :root {
            --primary-color: #3B82F6; /* Xanh d∆∞∆°ng */
            --secondary-color: #10B981; /* Xanh l√° */
            --background-color: #F0F9FF; /* Xanh d∆∞∆°ng r·∫•t nh·∫°t */
            --text-color: #1F2937; /* X√°m ƒë·∫≠m */
            --light-text-color: #6B7280; /* X√°m nh·∫°t */
            --card-bg: #FFFFFF;
            --shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            --border-radius: 16px;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            overflow-x: hidden;
        }
        /* --- HI·ªÜU ·ª®NG PRELOADER (M√ÄN H√åNH CH·ªú) --- */
        #preloader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            transition: opacity 0.7s ease-in-out, visibility 0.7s ease-in-out;
        }
        #preloader.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .whale-loader {
            width: 150px;
            height: 150px;
            animation: whale-bob 2s ease-in-out infinite;
        }
        @keyframes whale-bob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        #preloader p {
            margin-top: 20px;
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: 500;
        }
        /* --- B·ªê C·ª§C CH√çNH --- */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        header {
            text-align: center;
            margin-bottom: 3rem;
        }
        header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            cursor: pointer; /* ƒê·ªÉ m·ªü admin panel */
        }
        header p {
            font-size: 1.2rem;
            color: var(--light-text-color);
        }
        /* --- C√ÅC N√öT B·∫§M CH√çNH --- */
        .main-actions {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        .btn {
            padding: 1rem 2rem;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }
        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: all 0.6s ease;
        }
        .btn:hover:before {
            left: 100%;
        }
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* --- PH·∫¶N N·ªòI DUNG TH√îNG TIN --- */
        #info-section {
            background-color: var(--card-bg);
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 2rem;
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        #info-section h2 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 2rem;
        }
        .info-block {
            display: flex;
            gap: 2rem;
            align-items: center;
            margin-bottom: 2.5rem;
        }
        .info-block:nth-child(odd) {
             flex-direction: row-reverse;
        }
        .info-text {
            flex: 1;
        }
        .info-image {
            flex: 0 0 250px; /* H√¨nh ·∫£nh c√≥ chi·ªÅu r·ªông c·ªë ƒë·ªãnh */
            text-align: center;
        }
        .info-image img {
            max-width: 100%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }
        .info-block h3 {
            color: var(--secondary-color);
            margin-bottom: 0.5rem;
        }
        .info-links h3 {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        .info-links ul {
            list-style: none;
            padding-left: 0;
        }
        .info-links li {
            margin-bottom: 0.5rem;
        }
        .info-links a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }
        .info-links a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }
        
        /* --- ROBOT CHIBI "T√àO AURA" --- */
        #teo-aura-bot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 150px;
            height: 150px;
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        #teo-aura-bot:hover {
            transform: scale(1.1);
        }
        .robot-svg {
            width: 100%;
            height: 100%;
            animation: robot-float 3s ease-in-out infinite;
        }
        .robot-svg .eye, .robot-svg .eye-happy {
            transition: opacity 0.3s ease;
        }
        .robot-svg .eye-happy {
            opacity: 0;
        }
        #teo-aura-bot:hover .robot-svg .eye {
            opacity: 0;
        }
        #teo-aura-bot:hover .robot-svg .eye-happy {
            opacity: 1;
        }

        @keyframes robot-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }
        #teo-speech-bubble {
            position: fixed;
            bottom: 180px;
            right: 50px;
            background-color: var(--card-bg);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 300px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            z-index: 1001;
            font-size: 0.95rem;
        }
        #teo-speech-bubble.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* --- MODAL (KHUNG POP-UP) --- */
        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            justify-content: center;
            align-items: center;
            animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background-color: var(--background-color);
            margin: auto;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 600px;
            position: relative;
            text-align: center;
        }
        .close-btn {
            color: var(--light-text-color);
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-btn:hover {
            color: var(--text-color);
        }
        
        /* --- KH·∫¢O S√ÅT --- */
        #survey-modal h2 {
            color: var(--primary-color);
            margin-bottom: 2rem;
        }
        .survey-step { display: none; }
        .survey-step.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        #nickname-step input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            margin-bottom: 1rem;
        }
        
        #question-step-layout {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        #survey-robot {
            flex-shrink: 0;
        }
        #survey-robot .robot-svg {
            width: 120px;
            height: 120px;
            animation: none; /* T·∫Øt animation float trong survey */
        }
        #question-bubble {
            flex-grow: 1;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
            box-shadow: var(--shadow);
            border: 2px solid var(--primary-color);
        }
        #question-bubble::before {
            content: '';
            position: absolute;
            left: -20px;
            top: 50%;
            transform: translateY(-50%);
            border-width: 10px;
            border-style: solid;
            border-color: transparent var(--primary-color) transparent transparent;
        }
        
        #question-text {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 1.5rem;
        }
        .answer-options {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        .answer-options label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background-color 0.2s;
            width: 100%;
        }
        .answer-options input[type="radio"] {
            margin-right: 10px;
        }
        .answer-options label:hover {
            background-color: #e0f2fe;
        }
        
        #encouragement-text {
            color: var(--secondary-color);
            font-weight: 700;
            text-align: center;
            margin-top: 1rem;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease, height 0.5s ease;
        }
        #encouragement-text.visible {
            opacity: 1;
            height: 30px; /* ƒêi·ªÅu ch·ªânh chi·ªÅu cao ph√π h·ª£p */
            animation: slideUpFadeIn 0.8s ease-out;
        }
        @keyframes slideUpFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 1.5rem 0;
        }
        #progress-bar {
            width: 0%;
            height: 10px;
            background-color: var(--secondary-color);
            border-radius: 10px;
            transition: width 0.4s ease;
        }
        .survey-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        .survey-nav .btn-secondary {
            background: var(--card-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            box-shadow: none;
        }
        .survey-nav .btn-secondary:hover { background: #e0f2fe; }
        
        #result-step h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        #result-score {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--secondary-color);
        }
        #result-level {
            font-size: 1.5rem;
            font-weight: 500;
            margin: 0.5rem 0 1.5rem;
        }
        #result-advice {
            font-size: 1.1rem;
            color: var(--light-text-color);
            line-height: 1.7;
            background: #e0f2fe;
            padding: 1rem;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
            text-align: left;
        }
        
        /* --- MINIGAME --- */
        #game-modal .modal-content {
            max-width: 800px;
        }
        #game-container {
            position: relative;
            width: 100%;
            height: 500px; /* S·∫Ω ƒë∆∞·ª£c JS ƒëi·ªÅu ch·ªânh */
        }
        #game-canvas {
            background: linear-gradient(to bottom, #87CEEB 0%, #a2dff3 100%);
            border-radius: 8px;
            width: 100%;
            height: 100%;
            display: block;
        }
        /* MODIFIED: N√∫t ƒëi·ªÅu khi·ªÉn tr√™n di ƒë·ªông (b·ªè n√∫t b·∫Øn) */
        #mobile-controls {
            display: none; /* ·∫®n tr√™n desktop */
            position: absolute;
            bottom: 20px;
            width: 100%;
            justify-content: space-between; /* ƒê·∫∑t 2 n√∫t ·ªü 2 b√™n */
            align-items: center;
            padding: 0 30px;
        }
        .mobile-btn {
            width: 70px;
            height: 70px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            color: var(--primary-color);
            font-size: 2.5rem;
            font-weight: bold;
            border: 2px solid white;
            display: flex;
            justify-content: center;
            align-items: center;
            user-select: none;
        }
        #game-modal h2 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }
        #game-modal p {
            margin-bottom: 1rem;
            color: var(--light-text-color);
        }
        #game-end-screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none; /* S·ª≠a th√†nh flex ƒë·ªÉ hi·ªÉn th·ªã */
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            color: white;
            padding: 20px;
            border-radius: 8px;
            animation: fadeIn 0.5s;
        }
        #game-end-robot { width: 150px; height: 150px; margin-bottom: 20px; }
        #game-end-message { font-size: 1.3rem; max-width: 80%; }
        
        /* --- ADMIN PANEL --- */
        #admin-modal .modal-content { max-width: 800px; }
        #admin-modal h2 { color: var(--primary-color); margin-bottom: 1.5rem; }
        #admin-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        #admin-table th, #admin-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        #admin-table th { background-color: #e0f2fe; color: var(--primary-color); }
        #admin-table tbody tr:nth-child(even) { background-color: #f8fafc; }
        
        /* --- RESPONSIVE DESIGN --- */
        @media (max-width: 768px) {
            header h1 { font-size: 2.2rem; }
            .main-actions { flex-direction: column; align-items: center; }
            
            .info-block, .info-block:nth-child(odd) {
                flex-direction: column;
            }
            .info-image { margin-bottom: 1.5rem; }

            #teo-aura-bot { width: 100px; height: 100px; right: 10px; bottom: 10px; }
            #teo-speech-bubble { bottom: 120px; right: 10px; max-width: calc(100vw - 40px); }
            
            #question-step-layout { flex-direction: column; gap: 10px; }
            #question-bubble::before {
                left: 50%;
                top: -20px;
                transform: translateX(-50%);
                border-color: transparent transparent var(--primary-color) transparent;
            }

            .modal-content { padding: 20px; }
            
            #game-container { height: 400px; }
            #mobile-controls { display: flex; } /* Hi·ªÉn th·ªã n√∫t tr√™n di ƒë·ªông */
        }
    </style>
</head>
<body>

    <div id="preloader">
        <svg class="whale-loader" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path fill="#3B82F6" d="M95.6,35.9c-2.4-9.3-9.8-16.7-19.1-19.1c-2.8-0.7-5.7-1.1-8.6-1.1c-12.8,0-23.8,8.1-28.3,19.6 c-0.5,1.2-0.8,2.5-1.1,3.8c-2.3,0.1-4.5,0.5-6.6,1.2c-7.3,2.4-12.9,8-15.3,15.3c-0.7,2.1-1.1,4.3-1.2,6.6 c-1.2-0.3-2.5-0.5-3.8-0.8C4.5,60,0,55.1,0,48.5c0-3.3,1.3-6.4,3.5-8.6c-1.8-4.4-2.2-9.3-1.1-14c2.4-9.3,9.8-16.7,19.1-19.1 C24.4,6,27.7,5.4,31.1,5.4c3.4,0,6.7,0.6,9.8,1.8c4.4-5.3,10.6-8.8,17.6-8.8c9.9,0,18.3,6.5,21.3,15.5c2.9-1,6-1.6,9.2-1.6 c7.6,0,14.3,3.7,18.5,9.4C102.3,28.2,99.9,33.1,95.6,35.9z"/>
            <ellipse fill="#FFFFFF" cx="75" cy="28" rx="4" ry="5"/>
        </svg>
        <p>ƒêang t·∫£i th·∫ø gi·ªõi di·ªáu k·ª≥...</p>
    </div>

    <div class="container">
        <header>
            <h1 id="main-title">H√†nh Tr√¨nh Ch·ªØa L√†nh & Tr∆∞·ªüng Th√†nh</h1>
            <p>Kh√°m ph√° m·ªëi li√™n h·ªá gi·ªØa kh·∫£ nƒÉng ph·ª•c h·ªìi v√† √°p l·ª±c h·ªçc t·∫≠p</p>
        </header>

        <div class="main-actions">
            <button class="btn" id="info-btn">T√¨m hi·ªÉu th√™m th√¥ng tin</button>
            <button class="btn" id="survey-btn">L√†m b√†i kh·∫£o s√°t nhanh</button>
            <button class="btn" id="game-btn">Minigame: ƒê∆∞·ªùng ƒëua d≈©ng c·∫£m</button>
        </div>

        <div id="teo-aura-bot">
            <svg class="robot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <g>
                    <path d="M100 55 C 110 40, 110 30, 100 20" stroke="#616161" stroke-width="4" fill="none" />
                    <circle cx="100" cy="18" r="7" fill="#FBC02D"/>
                    <path d="M 60,110 C 40,110 30,80 60,60 C 80,40 120,40 140,60 C 170,80 160,110 140,110 Z" fill="#90CAF9"/>
                    <path d="M 50,180 C 30,180 20,130 50,120 L 150,120 C 180,130 170,180 150,180 Z" fill="#4A90E2"/>
                     <g class="eye">
                        <line x1="80" y1="85" x2="95" y2="85" stroke="#212121" stroke-width="5" stroke-linecap="round"/>
                        <line x1="105" y1="85" x2="120" y2="85" stroke="#212121" stroke-width="5" stroke-linecap="round"/>
                    </g>
                    <g class="eye-happy">
                        <path d="M 80 85 Q 87.5 95, 95 85" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/>
                        <path d="M 105 85 Q 112.5 95, 120 85" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/>
                    </g>
                </g>
            </svg>
        </div>
        <div id="teo-speech-bubble">
            Xin ch√†o em! Anh l√† T√®o Aura. Em c√≥ ƒëi·ªÅu g√¨ c·∫ßn anh gi√∫p kh√¥ng?
        </div>

        <section id="info-section">
            <h2>M·ªëi Li√™n H·ªá Gi·ªØa Kh·∫£ NƒÉng Ph·ª•c H·ªìi v√† √Åp L·ª±c H·ªçc T·∫≠p</h2>
            <div class="info-block">
                <div class="info-text">
                    <h3>1. √Åp l·ª±c h·ªçc t·∫≠p l√† g√¨?</h3>
                    <p>√Åp l·ª±c h·ªçc t·∫≠p l√† nh·ªØng cƒÉng th·∫≥ng, lo √¢u m√† h·ªçc sinh ph·∫£i ƒë·ªëi m·∫∑t t·ª´ nhi·ªÅu ph√≠a: kh·ªëi l∆∞·ª£ng b√†i v·ªü l·ªõn, k·ª≥ v·ªçng c·ªßa gia ƒë√¨nh, th·∫ßy c√¥, s·ª± c·∫°nh tranh t·ª´ b·∫°n b√® v√† c·∫£ nh·ªØng m·ª•c ti√™u do ch√≠nh b·∫£n th√¢n ƒë·∫∑t ra.
                    ƒê√¢y l√† m·ªôt ph·∫ßn kh√¥ng th·ªÉ tr√°nh kh·ªèi trong qu√° tr√¨nh h·ªçc t·∫≠p, nh∆∞ng n·∫øu qu√° m·ª©c, n√≥ c√≥ th·ªÉ g√¢y ·∫£nh h∆∞·ªüng ti√™u c·ª±c ƒë·∫øn s·ª©c kh·ªèe tinh th·∫ßn v√† th·ªÉ ch·∫•t.</p>
                </div>
                <div class="info-image">
                    <img src="https://placehold.co/400x300/3B82F6/FFFFFF?text=√Åp+L·ª±c" alt="Minh h·ªça √°p l·ª±c h·ªçc t·∫≠p">
                </div>
            </div>
            <div class="info-block">
                <div class="info-text">
                    <h3>2. Kh·∫£ nƒÉng ph·ª•c h·ªìi (Resilience) - "S·ª©c b·∫≠t" tinh th·∫ßn</h3>
                    <p>Kh·∫£ nƒÉng ph·ª•c h·ªìi l√† nƒÉng l·ª±c v∆∞·ª£t qua, th√≠ch ·ª©ng v√† th·∫≠m ch√≠ l√† ph√°t tri·ªÉn m·∫°nh m·∫Ω h∆°n sau khi ƒë·ªëi m·∫∑t v·ªõi ngh·ªãch c·∫£nh, ch·∫•n th∆∞∆°ng, ho·∫∑c cƒÉng th·∫≥ng.
                    N√≥ kh√¥ng ph·∫£i l√† "kh√¥ng bao gi·ªù g·ª•c ng√£", m√† l√† kh·∫£ nƒÉng "ƒë·ª©ng d·∫≠y sau m·ªói l·∫ßn v·∫•p ng√£".
                    ƒê√¢y l√† m·ªôt k·ªπ nƒÉng c√≥ th·ªÉ r√®n luy·ªán ƒë∆∞·ª£c.</p>
                </div>
                <div class="info-image">
                     <img src="https://placehold.co/400x300/10B981/FFFFFF?text=Ph·ª•c+H·ªìi" alt="Minh h·ªça kh·∫£ nƒÉng ph·ª•c h·ªìi">
                </div>
            </div>
             <div class="info-block">
                 <div class="info-text">
                    <h3>3. M·ªëi li√™n h·ªá quan tr·ªçng</h3>
                    <p>H·ªçc sinh c√≥ kh·∫£ nƒÉng ph·ª•c h·ªìi t·ªët th∆∞·ªùng c√≥ xu h∆∞·ªõng:
                    <br>- Xem th√°ch th·ª©c l√† c∆° h·ªôi ƒë·ªÉ h·ªçc h·ªèi.
                    <br>- C√≥ k·ªπ nƒÉng gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ hi·ªáu qu·∫£ h∆°n.
                    <br>- Duy tr√¨ th√°i ƒë·ªô l·∫°c quan v√† tin t∆∞·ªüng v√†o b·∫£n th√¢n.
                    <br>- Bi·∫øt c√°ch t√¨m ki·∫øm s·ª± gi√∫p ƒë·ª° khi c·∫ßn thi·∫øt.
                    <br>Nh·ªù v·∫≠y, h·ªç c√≥ th·ªÉ "chuy·ªÉn h√≥a" √°p l·ª±c th√†nh ƒë·ªông l·ª±c, gi·∫£m thi·ªÉu c√°c t√°c ƒë·ªông ti√™u c·ª±c c·ªßa stress v√† ƒë·∫°t ƒë∆∞·ª£c th√†nh c√¥ng m·ªôt c√°ch b·ªÅn v·ªØng h∆°n.</p>
                 </div>
                 <div class="info-image">
                     <img src="https://placehold.co/400x300/F59E0B/FFFFFF?text=Th√†nh+C√¥ng" alt="Minh h·ªça th√†nh c√¥ng">
                </div>
            </div>
            <div class="info-links">
                <h3>C√°c b√†i b√°o v√† t√†i li·ªáu tham kh·∫£o:</h3>
                <ul>
                    <li><a href="https://vietnamnet.vn/ap-luc-hoc-hanh-cua-hoc-sinh-viet-nam-khien-chuyen-gia-nuoc-ngoai-soc-2115160.html" target="_blank">VietNamNet: √Åp l·ª±c h·ªçc h√†nh c·ªßa h·ªçc sinh Vi·ªát Nam</a></li>
                    <li><a href="https://suckhoedoisong.vn/lam-gi-de-giup-tre-vuot-qua-ap-luc-hoc-tap-169230524180052739.htm" target="_blank">B√°o S·ª©c kh·ªèe & ƒê·ªùi s·ªëng: Gi√∫p tr·∫ª v∆∞·ª£t qua √°p l·ª±c h·ªçc t·∫≠p</a></li>
                    <li><a href="https://www.apa.org/topics/resilience" target="_blank">American Psychological Association: Building your resilience (Ti·∫øng Anh)</a></li>
                </ul>
            </div>
        </section>
    </div>

    <div id="survey-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="nickname-step" class="survey-step active">
                <h2>Kh·∫£o s√°t nhanh v·ªÅ m·ª©c ƒë·ªô lo √¢u</h2>
                <p>Tr∆∞·ªõc khi b·∫Øt ƒë·∫ßu, h√£y cho T√®o bi·∫øt bi·ªát danh c·ªßa em nh√©!</p>
                <input type="text" id="nickname-input" placeholder="Nh·∫≠p bi·ªát danh c·ªßa em...">
                <button class="btn" id="start-survey-btn">B·∫Øt ƒë·∫ßu</button>
            </div>
            
            <div id="question-step" class="survey-step">
                <div id="question-step-layout">
                    <div id="survey-robot">
                    </div>
                    <div id="question-bubble">
                        <div id="question-container">
                            <p id="question-text"></p>
                            <div class="answer-options" id="answer-options"></div>
                        </div>
                    </div>
                </div>
                
                <p id="encouragement-text">C·ªë g·∫Øng l√™n nh√©, em s·∫Øp ho√†n th√†nh xong r·ªìi!</p>

                <div id="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
                <div class="survey-nav">
                    <button class="btn btn-secondary" id="prev-btn">Quay l·∫°i</button>
                    <button class="btn" id="next-btn">Ti·∫øp theo</button>
                </div>
            </div>

            <div id="result-step" class="survey-step">
                <h2>K·∫øt qu·∫£ c·ªßa em</h2>
                <h3 id="result-nickname"></h3>
                <p>T·ªïng ƒëi·ªÉm c·ªßa em l√†:</p>
                <p id="result-score"></p>
                <p id="result-level"></p>
                <div id="result-advice"></div>
                <button class="btn" id="close-result-btn" style="margin-top: 20px;">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <div id="game-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>Minigame: ƒê∆∞·ªùng ƒëua d≈©ng c·∫£m</h2>
            <p>D√πng ph√≠m m≈©i t√™n (‚Üê ‚Üí) ho·∫∑c n√∫t b·∫•m tr√™n m√†n h√¨nh ƒë·ªÉ di chuy·ªÉn.
            <br>H√£y thu th·∫≠p v·∫≠t ph·∫©m h·ªó tr·ª£ (üõ°Ô∏è‚ö°Ô∏è) v√† n√© tr√°nh ch∆∞·ªõng ng·∫°i v·∫≠t nh√©!</p>
            
            <div id="game-container">
                <canvas id="game-canvas"></canvas>
                <div id="mobile-controls">
                    <div class="mobile-btn" id="left-btn">‚Üê</div>
                    <div class="mobile-btn" id="right-btn">‚Üí</div>
                </div>
                <div id="game-end-screen">
                     <div id="game-end-robot"></div>
                     <p id="game-end-message"></p>
                </div>
            </div>
        </div>
    </div>

    <div id="admin-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h2>D·ªØ li·ªáu kh·∫£o s√°t</h2>
            <p>T·ªïng s·ªë l∆∞·ª£t tham gia: <span id="participant-count">0</span></p>
            <table id="admin-table">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Bi·ªát danh</th>
                        <th>ƒêi·ªÉm</th>
                        <th>M·ª©c ƒë·ªô</th>
                        <th>Th·ªùi gian</th>
                    </tr>
                </thead>
                <tbody id="admin-table-body">
                </tbody>
            </table>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const preloader = document.getElementById('preloader');
    window.addEventListener('load', () => {
        preloader.classList.add('hidden');
    });

    const infoBtn = document.getElementById('info-btn');
    const surveyBtn = document.getElementById('survey-btn');
    const gameBtn = document.getElementById('game-btn');
    const infoSection = document.getElementById('info-section');
    const surveyModal = document.getElementById('survey-modal');
    const gameModal = document.getElementById('game-modal');
    const adminModal = document.getElementById('admin-modal');
    const closeBtns = document.querySelectorAll('.close-btn');
    const teoBot = document.getElementById('teo-aura-bot');
    const teoSpeechBubble = document.getElementById('teo-speech-bubble');
    const originalTeoSpeech = teoSpeechBubble.innerHTML;
    const teoCuteSVG = teoBot.innerHTML; 

    infoBtn.addEventListener('click', () => {
        const isVisible = infoSection.style.display === 'block';
        infoSection.style.display = isVisible ? 'none' : 'block';
        infoBtn.textContent = isVisible ? '·∫®n b·ªõt th√¥ng tin' : 'T√¨m hi·ªÉu th√™m th√¥ng tin';
    });
    
    surveyBtn.addEventListener('click', () => {
        surveyModal.style.display = 'flex';
        resetSurvey();
    });

    gameBtn.addEventListener('click', () => {
        gameModal.style.display = 'flex';
        setTimeout(startGame, 100); 
    });

    closeBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            btn.closest('.modal').style.display = 'none';
            if (gameRunning) {
                stopGame();
            }
        });
    });

    window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = 'none';
            if (gameRunning) {
                stopGame();
            }
        }
    });

    let speechTimeout;
    teoBot.addEventListener('mouseenter', () => {
        clearTimeout(speechTimeout);
        teoSpeechBubble.innerHTML = 'Ch√∫c em c√≥ m·ªôt ng√†y t·ªët l√†nh! üòä';
        teoSpeechBubble.classList.add('visible');
    });
    teoBot.addEventListener('mouseleave', () => {
        speechTimeout = setTimeout(() => {
            teoSpeechBubble.classList.remove('visible');
            setTimeout(() => { teoSpeechBubble.innerHTML = originalTeoSpeech; }, 400);
        }, 2000);
    });

    // --- PH·∫¶N 4: LOGIC C·ª¶A B√ÄI KH·∫¢O S√ÅT ---
    const surveyData = [];
    const GAD7_QUESTIONS = [
        "C·∫£m th·∫•y lo l·∫Øng, b·ªìn ch·ªìn ho·∫∑c cƒÉng th·∫≥ng?",
        "Kh√¥ng th·ªÉ d·ª´ng l·∫°i ho·∫∑c ki·ªÉm so√°t ƒë∆∞·ª£c s·ª± lo l·∫Øng?",
        "Lo l·∫Øng qu√° nhi·ªÅu v·ªÅ nh·ªØng ƒëi·ªÅu kh√°c nhau?",
        "Kh√≥ th∆∞ gi√£n?",
        "C·∫£m th·∫•y b·ªìn ch·ªìn ƒë·∫øn m·ª©c kh√¥ng th·ªÉ ng·ªìi y√™n?",
        "D·ªÖ tr·ªü n√™n c√°u k·ªânh ho·∫∑c kh√≥ ch·ªãu?",
        "C·∫£m th·∫•y s·ª£ h√£i nh∆∞ th·ªÉ c√≥ ƒëi·ªÅu g√¨ ƒë√≥ kh·ªßng khi·∫øp s·∫Øp x·∫£y ra?"
    ];
    const GAD7_ANSWERS = [
        { text: "Kh√¥ng ng√†y n√†o", value: 0 },
        { text: "V√†i ng√†y", value: 1 },
        { text: "H∆°n m·ªôt n·ª≠a s·ªë ng√†y", value: 2 },
        { text: "G·∫ßn nh∆∞ m·ªói ng√†y", value: 3 }
    ];
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let userNickname = '';
    
    const nicknameStep = document.getElementById('nickname-step');
    const questionStep = document.getElementById('question-step');
    const resultStep = document.getElementById('result-step');
    const startSurveyBtn = document.getElementById('start-survey-btn');
    const nicknameInput = document.getElementById('nickname-input');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const questionText = document.getElementById('question-text');
    const answerOptionsContainer = document.getElementById('answer-options');
    const progressBar = document.getElementById('progress-bar');
    const closeResultBtn = document.getElementById('close-result-btn');
    const surveyRobotContainer = document.getElementById('survey-robot');
    const encouragementText = document.getElementById('encouragement-text');

    function resetSurvey() {
        currentQuestionIndex = 0;
        userAnswers = [];
        userNickname = '';
        nicknameInput.value = '';
        nicknameStep.classList.add('active');
        questionStep.classList.remove('active');
        resultStep.classList.remove('active');
        surveyRobotContainer.innerHTML = teoCuteSVG;
    }

    startSurveyBtn.addEventListener('click', () => {
        userNickname = nicknameInput.value.trim();
        if (userNickname === '') {
            alert('Em vui l√≤ng nh·∫≠p bi·ªát danh nh√©!');
            return;
        }
        nicknameStep.classList.remove('active');
        questionStep.classList.add('active');
        showQuestion();
    });

    function showQuestion() {
        const question = GAD7_QUESTIONS[currentQuestionIndex];
        questionText.textContent = `T√®o h·ªèi nh·ªè n√®: Trong 2 tu·∫ßn qua, em c√≥ th∆∞·ªùng... "${question}"`;

        answerOptionsContainer.innerHTML = '';
        GAD7_ANSWERS.forEach((answer, index) => {
            const optionId = `q${currentQuestionIndex}-a${index}`;
            const checked = userAnswers[currentQuestionIndex] === answer.value ? 'checked' : '';
            answerOptionsContainer.innerHTML += `
                <label for="${optionId}">
                    <input type="radio" name="answer" id="${optionId}" value="${answer.value}" ${checked}>
                    ${answer.text}
                </label>
            `;
        });
        
        if (currentQuestionIndex === 5) {
            encouragementText.classList.add('visible');
        } else {
            encouragementText.classList.remove('visible');
        }

        updateProgressBar();
        updateNavButtons();
    }

    function updateProgressBar() {
        const progress = ((currentQuestionIndex + 1) / GAD7_QUESTIONS.length) * 100;
        progressBar.style.width = `${progress}%`;
    }

    function updateNavButtons() {
        prevBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
        nextBtn.textContent = currentQuestionIndex === GAD7_QUESTIONS.length - 1 ? 'Ho√†n th√†nh' : 'Ti·∫øp theo';
    }

    nextBtn.addEventListener('click', () => {
        const selectedAnswer = document.querySelector('input[name="answer"]:checked');
        if (!selectedAnswer) {
            alert('Em h√£y ch·ªçn m·ªôt c√¢u tr·∫£ l·ªùi nh√©!');
            return;
        }
        userAnswers[currentQuestionIndex] = parseInt(selectedAnswer.value);
        if (currentQuestionIndex < GAD7_QUESTIONS.length - 1) {
            currentQuestionIndex++;
            showQuestion();
        } else {
            showResults();
        }
    });
    
    prevBtn.addEventListener('click', () => {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            showQuestion();
        }
    });

    function showResults() {
        questionStep.classList.remove('active');
        resultStep.classList.add('active');
        const totalScore = userAnswers.reduce((sum, answer) => sum + answer, 0);
        let level = '';
        let advice = '';

        if (totalScore <= 4) {
            level = "M·ª©c ƒë·ªô lo √¢u t·ªëi thi·ªÉu";
            advice = `Em ƒëang l√†m r·∫•t t·ªët trong vi·ªác qu·∫£n l√Ω c·∫£m x√∫c c·ªßa m√¨nh. H√£y ti·∫øp t·ª•c duy tr√¨ nh·ªØng th√≥i quen t√≠ch c·ª±c nh√©. T√®o r·∫•t t·ª± h√†o v·ªÅ em!`;
        } else if (totalScore <= 9) {
            level = "M·ª©c ƒë·ªô lo √¢u nh·∫π";
            advice = `Th·ªânh tho·∫£ng c·∫£m th·∫•y lo l·∫Øng m·ªôt ch√∫t l√† chuy·ªán b√¨nh th∆∞·ªùng th√¥i em √†. H√£y th·ª≠ d√†nh th·ªùi gian cho s·ªü th√≠ch c·ªßa m√¨nh ho·∫∑c tr√≤ chuy·ªán v·ªõi b·∫°n b√®, ng∆∞·ªùi th√¢n. M·ªçi chuy·ªán r·ªìi s·∫Ω ·ªïn th√¥i.`;
        } else if (totalScore <= 14) {
            level = "M·ª©c ƒë·ªô lo √¢u v·ª´a";
            advice = `T√®o hi·ªÉu em ƒëang c·∫£m th·∫•y kh√° cƒÉng th·∫≥ng. ƒê·ª´ng qu√™n h√≠t th·ªü s√¢u v√† cho ph√©p m√¨nh ƒë∆∞·ª£c ngh·ªâ ng∆°i nh√©. Em kh√¥ng h·ªÅ ƒë∆°n ƒë·ªôc ƒë√¢u, T√®o lu√¥n ·ªü ƒë√¢y l·∫Øng nghe.`;
        } else {
            level = "M·ª©c ƒë·ªô lo √¢u n·∫∑ng";
            advice = `Em √†, em ƒë√£ r·∫•t d≈©ng c·∫£m khi ƒë·ªëi m·∫∑t v·ªõi nh·ªØng c·∫£m x√∫c n√†y. ƒê·ª´ng ng·∫ßn ng·∫°i t√¨m ki·∫øm s·ª± gi√∫p ƒë·ª° t·ª´ chuy√™n gia t√¢m l√Ω ho·∫∑c ng∆∞·ªùi l·ªõn m√† em tin t∆∞·ªüng nh√©. Em x·ª©ng ƒë√°ng ƒë∆∞·ª£c y√™u th∆∞∆°ng v√† h·ªó tr·ª£.`;
        }
        document.getElementById('result-nickname').textContent = `D√†nh cho ${userNickname},`;
        document.getElementById('result-score').textContent = totalScore;
        document.getElementById('result-level').textContent = level;
        document.getElementById('result-advice').textContent = advice;

        const resultData = {
            nickname: userNickname, score: totalScore, level: level,
            timestamp: new Date().toLocaleString('vi-VN')
        };
        surveyData.push(resultData);
        updateAdminPanel();
    }
    
    closeResultBtn.addEventListener('click', () => {
        surveyModal.style.display = 'none';
    });

    // --- PH·∫¶N 5: LOGIC C·ª¶A ADMIN PANEL ---
    const mainTitle = document.getElementById('main-title');
    let titleClickCount = 0;
    mainTitle.addEventListener('click', () => {
        titleClickCount++;
        if (titleClickCount >= 5) {
            adminModal.style.display = 'flex';
            titleClickCount = 0;
        }
        setTimeout(() => { titleClickCount = 0; }, 2000);
    });

    function updateAdminPanel() {
        const tableBody = document.getElementById('admin-table-body');
        const participantCount = document.getElementById('participant-count');
        participantCount.textContent = surveyData.length;
        tableBody.innerHTML = '';
        surveyData.forEach((data, index) => {
            const row = `
                <tr>
                    <td>${index + 1}</td>
                    <td>${data.nickname}</td>
                    <td>${data.score}</td>
                    <td>${data.level}</td>
                    <td>${data.timestamp}</td>
                </tr>
            `;
            tableBody.innerHTML += row;
        });
    }

    // --- PH·∫¶N 6: LOGIC C·ª¶A MINIGAME (MODIFIED) ---
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    const gameEndScreen = document.getElementById('game-end-screen');
    const gameEndRobot = document.getElementById('game-end-robot');
    const gameEndMessage = document.getElementById('game-end-message');
    
    // MODIFIED: Lo·∫°i b·ªè `lasers` v√† `finishLine`
    let player, obstacles, powerUps;
    let score = 0, gameFrame = 0, gameRunning = false, animationFrameId;
    const WIN_SCORE = 100;

    const keys = { arrowRight: false, arrowLeft: false };
    
    const playerRobotSVG = new Image();
    playerRobotSVG.src = "data:image/svg+xml," + encodeURIComponent(teoCuteSVG);

    class Player {
        constructor() {
            this.width = 70;
            this.height = 70;
            this.x = canvas.width / 2 - this.width / 2;
            this.y = canvas.height - this.height - 20;
            this.baseSpeed = 6;
            this.speed = this.baseSpeed;
            this.speedBoostTimer = 0;
            this.hasShield = false;
            this.shieldTimer = 0;
        }
        update() {
            if (keys.arrowRight && this.x < canvas.width - this.width) this.x += this.speed;
            if (keys.arrowLeft && this.x > 0) this.x -= this.speed;
            
            if(this.speedBoostTimer > 0) {
                this.speedBoostTimer--;
                if (this.speedBoostTimer === 0) this.speed = this.baseSpeed;
            }
             if(this.shieldTimer > 0) {
                this.shieldTimer--;
                if (this.shieldTimer === 0) this.hasShield = false;
            }
        }
        draw() {
            ctx.drawImage(playerRobotSVG, this.x, this.y, this.width, this.height);
            if(this.hasShield) {
                ctx.beginPath();
                ctx.arc(this.x + this.width / 2, this.y + this.height / 2, this.width / 2 + 5, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
                ctx.strokeStyle = 'rgba(59, 130, 246, 0.8)';
                ctx.lineWidth = 3;
                ctx.fill();
                ctx.stroke();
            }
        }
    }
    
    class GameObject {
         constructor(x, y, speed, type) {
            this.x = x;
            this.y = y;
            this.speed = speed;
            this.type = type;
            this.width = 50; this.height = 50;
            this.text = ''; this.color = 'red'; this.emoji = '‚ùì';
            
            switch(type) {
                case 'obstacle':
                    const obsTypes = [{e: 'üìö', t: 'B√†i t·∫≠p'}, {e: 'üìâ', t: 'ƒêi·ªÉm s·ªë'}, {e: 'üó£Ô∏è', t: 'Ch·ªâ tr√≠ch'}];
                    const chosenObs = obsTypes[Math.floor(Math.random() * obsTypes.length)];
                    this.emoji = chosenObs.e; this.text = chosenObs.t; this.color = '#EF4444';
                    this.width = 80; this.height = 40;
                    break;
                case 'shield':
                    this.emoji = 'üõ°Ô∏è'; this.text = 'Khi√™n'; this.color = '#3B82F6';
                    break;
                case 'speed':
                    this.emoji = '‚ö°Ô∏è'; this.text = 'T·ªëc ƒë·ªô'; this.color = '#F59E0B';
                    break;
            }
        }
        update() { this.y += this.speed; }
        draw() {
            ctx.fillStyle = this.color;
            ctx.globalAlpha = 0.8;
            roundRect(ctx, this.x, this.y, this.width, this.height, 10, true, false);
            ctx.globalAlpha = 1;
            ctx.fillStyle = 'white';
            ctx.font = '24px sans-serif';
            ctx.textAlign = 'center';
            ctx.fillText(this.emoji, this.x + this.width / 2, this.y + this.height / 2 + 8);
        }
    }

    function startGame() {
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = canvas.parentElement.clientHeight;
        
        player = new Player();
        obstacles = []; powerUps = [];
        score = 0; gameFrame = 0; gameRunning = true;
        
        gameEndScreen.style.display = 'none';
        
        gameLoop();
    }
    
    function stopGame() {
        gameRunning = false;
        cancelAnimationFrame(animationFrameId);
    }
    
    function handleObjects() {
        // Add obstacles
        if (gameFrame % 90 === 0) {
            obstacles.push(new GameObject(Math.random() * (canvas.width - 80), -50, Math.random() * 1.5 + 2, 'obstacle'));
        }
        // Add power-ups
        if (gameFrame % 250 === 0) {
            const types = ['shield', 'speed']; // MODIFIED: B·ªè 'laser'
            const type = types[Math.floor(Math.random() * types.length)];
            powerUps.push(new GameObject(Math.random() * (canvas.width - 50), -50, 2, type));
        }
        
        // Update & draw obstacles
        obstacles.forEach((obs, index) => {
            obs.update();
            obs.draw();
            if (obs.y > canvas.height) obstacles.splice(index, 1);
            if (checkCollision(player, obs)) {
                 if (player.hasShield) {
                    player.hasShield = false;
                    obstacles.splice(index, 1);
                } else {
                    endGame(false);
                }
            }
        });

        // Update & draw power-ups
        powerUps.forEach((pow, index) => {
            pow.update();
            pow.draw();
            if (pow.y > canvas.height) powerUps.splice(index, 1);
            if (checkCollision(player, pow)) {
                powerUps.splice(index, 1);
                score += 10;
                switch(pow.type) {
                    case 'shield': player.hasShield = true; player.shieldTimer = 600; break;
                    case 'speed': player.speed = player.baseSpeed * 1.5; player.speedBoostTimer = 300; break;
                }
                // MODIFIED: Win condition tr·ª±c ti·∫øp
                if (score >= WIN_SCORE) {
                    endGame(true);
                }
            }
        });
    }

    function checkCollision(rect1, rect2) {
        return ( rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x &&
                 rect1.y < rect2.y + rect2.height && rect1.y + rect1.height > rect2.y );
    }

    function endGame(isWin) {
        stopGame();
        gameEndScreen.style.display = 'flex';
        
        let teoEndSVG;
        if(isWin) {
            teoEndSVG = `<svg class="robot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0, 10)"><path d="M100 55 C 110 40, 110 30, 100 20" stroke="#616161" stroke-width="4" fill="none" /><circle cx="100" cy="18" r="7" fill="#FBC02D"/><path d="M 60,110 C 40,110 30,80 60,60 C 80,40 120,40 140,60 C 170,80 160,110 140,110 Z" fill="#90CAF9"/><path d="M 50,180 C 30,180 20,130 50,120 L 150,120 C 180,130 170,180 150,180 Z" fill="#4A90E2"/><path d="M 80 85 Q 87.5 95, 95 85" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M 105 85 Q 112.5 95, 120 85" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M 90 100 Q 100 115, 110 100" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/></g></svg>`;
            gameEndMessage.innerHTML = `Chi·∫øn th·∫Øng r·ªìi! Em th·∫≠t l√† c·ª´ kh√¥i! <br> H√£y lu√¥n gi·ªØ v·ªØng tinh th·∫ßn d≈©ng c·∫£m n√†y nh√©!`;
        } else {
            teoEndSVG = `<svg class="robot-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><g transform="translate(0, 10)"><path d="M100 55 C 90 40, 90 30, 100 20" stroke="#616161" stroke-width="4" fill="none" /><circle cx="100" cy="18" r="7" fill="#FBC02D"/><path d="M 60,110 C 40,110 30,80 60,60 C 80,40 120,40 140,60 C 170,80 160,110 140,110 Z" fill="#90CAF9"/><path d="M 50,180 C 30,180 20,130 50,120 L 150,120 C 180,130 170,180 150,180 Z" fill="#4A90E2"/><path d="M 80 90 Q 87.5 80, 95 90" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M 105 90 Q 112.5 80, 120 90" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/><path d="M 90 110 Q 100 100, 110 110" stroke="#212121" stroke-width="5" fill="none" stroke-linecap="round"/></g></svg>`;
            gameEndMessage.innerHTML = `Kh√¥ng sao c·∫£ ƒë√¢u em ∆°i! Th·∫•t b·∫°i l√† m·∫π th√†nh c√¥ng m√†. <br> ƒêi·ªÅu quan tr·ªçng l√† em ƒë√£ d≈©ng c·∫£m ƒë·ªëi m·∫∑t. H√£y th·ª≠ l·∫°i nh√©!`;
        }
        gameEndRobot.innerHTML = teoEndSVG;
        
        setTimeout(() => {
            gameModal.style.display = 'none';
        }, 6000);
    }
    
    function drawUI() {
        ctx.fillStyle = 'white';
        ctx.font = 'bold 24px Be Vietnam Pro';
        
        // Draw score on the left
        ctx.textAlign = 'left';
        ctx.fillText('ƒêi·ªÉm: ' + score, 20, 40);
        
        // Draw win progress bar in the center
        let progress = score / WIN_SCORE;
        if (progress > 1) progress = 1;
        
        let barWidth = 200;
        let barX = canvas.width/2 - barWidth/2;
        ctx.fillStyle = '#ffffff80'; // semi-transparent white
        ctx.fillRect(barX, 20, barWidth, 20);
        ctx.fillStyle = '#F59E0B'; // gold color
        ctx.fillRect(barX, 20, barWidth * progress, 20);
        
        ctx.strokeStyle = 'white';
        ctx.strokeRect(barX, 20, barWidth, 20);
    }

    function gameLoop() {
        if (!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        player.draw();
        player.update();
        
        handleObjects();
        drawUI();

        gameFrame++;
        animationFrameId = requestAnimationFrame(gameLoop);
    }
    
    // --- Event Listeners for Game Control ---
    window.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') keys.arrowRight = true;
        if (e.key === 'ArrowLeft') keys.arrowLeft = true;
    });
    window.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowRight') keys.arrowRight = false;
        if (e.key === 'ArrowLeft') keys.arrowLeft = false;
    });

    // Mobile Controls
    const leftBtn = document.getElementById('left-btn');
    const rightBtn = document.getElementById('right-btn');

    leftBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.arrowLeft = true; });
    leftBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys.arrowLeft = false; });
    rightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys.arrowRight = true; });
    rightBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys.arrowRight = false; });
    
    function roundRect(ctx, x, y, width, height, radius, fill, stroke) {
      if (typeof stroke === 'undefined') { stroke = true; }
      if (typeof radius === 'undefined') { radius = 5; }
      ctx.beginPath();
      ctx.moveTo(x + radius, y);
      ctx.lineTo(x + width - radius, y);
      ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
      ctx.lineTo(x + width, y + height - radius);
      ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
      ctx.lineTo(x + radius, y + height);
      ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
      ctx.lineTo(x, y + radius);
      ctx.quadraticCurveTo(x, y, x + radius, y);
      ctx.closePath();
      if (fill) { ctx.fill(); }
      if (stroke) { ctx.stroke(); }
    }
});
</script>
</body>
</html>
